- hosts: all
  become: True
  tasks:
  - name: 'Install packages'
    package:
      name: "{{ item }}"
    with_items:
      - "sudo"

  - name: 'Add Users'
    user: 
      name: 'pontus'
      shell: '/bin/bash'
      generate_ssh_key: yes
      ssh_key_type: 'ED25519'

  - name: 'Add authorized_keys'
    authorized_key:
      user: 'pontus'
      key: 'https://github.com/pontusolsson.keys'
      exclusive: yes
      manage_dir: yes
  - name: 'Passwordless sudo'
    lineinfile:
      path: '/etc/sudoers'
      state: 'present'
      regexp: '^pontus\b'
      line: 'pontus ALL=(ALL) NOPASSWD: ALL'
   
